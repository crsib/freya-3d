#
# File generated by CMakeBuilder
#
#

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

PROJECT ( Freya3D )

#Global includes for all Freya Subprojects 
INCLUDE_DIRECTORIES( Framework/Include )

#Setup enviroment

SET ( CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/Build/Static )
SET ( CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/Build/Bin )
SET ( PLUGIN_OUTPUT_DIRECTORY 		 ${CMAKE_SOURCE_DIR}/Build/Bin/Plugins )
SET ( CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/Build/Bin )
SET ( INTERMIDIATE_DIRECTORY		 ${CMAKE_SOURCE_DIR}/Build/Intermediate )	

#IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
  SET(CMAKE_INSTALL_PREFIX "${CMAKE_SOURCE_DIR}/Build/Install" CACHE PATH "Default install prefix" FORCE)
#ENDIF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)


# Search for libraries
#Additional modules paths
SET	( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_SOURCE_DIR}/CMakeFind ${CMAKE_SOURCE_DIR}/CMakeIncludes )

#Search for bullet physics library
FIND_PACKAGE( Bullet REQUIRED )
IF( BULLET_FOUND )
    INCLUDE_DIRECTORIES(AFTER ${BULLET_INCLUDE_DIRS} )
ELSE( )
    MESSAGE(FATAL "Freya 3D engine is heavy dependent on Bullet!")
ENDIF()


# Link libraries to executables
DEFINE_PROPERTY(GLOBAL PROPERTY RUNTIME_LINK_LIBRARIES_GLOBAL BRIEF_DOCS "Put libraries to link with executables here"  FULL_DOCS "Put libraries to link with executables here")

SET ( RUNTIME_LINK_LIBRARIES )
#Search for stlport 
FIND_PACKAGE(STLPort REQUIRED)
MESSAGE ("STLPort: \n\tinclude: ${STLPORT_INCLUDE_DIR} \n\tlibs: ${STLPORT_LIBRARIES}" )
#Set STL port include directories
INCLUDE_DIRECTORIES( ${STLPORT_INCLUDE_DIR} )
#Set stlport linkage
SET(GLOBAL_LINK_LIBRARIES ${STLPORT_LIBRARIES})
IF(APPLE)
	FIND_LIBRARY(COREFOUNDATION CoreFoundation)
	MESSAGE("Using CoreFoundation as ${COREFOUNDATION}")
	SET(GLOBAL_LINK_LIBRARIES ${STLPORT_LIBRARIES} ${COREFOUNDATION})
ENDIF(APPLE)
# Link libraries to FreyaCore in case of its static building
DEFINE_PROPERTY(GLOBAL PROPERTY FREYA_CORE_LINK_LIBRARIES_GLOBAL BRIEF_DOCS "Put libraries to link with FreyaCore here"  FULL_DOCS "Put libraries to link with FreyaCore here")
SET ( FREYA_CORE_LINK_LIBRARIES )
# non standart libraries, that needed to be copied near to executable
SET ( INSTALL_LIBRARIES )

IF(APPLE)
	ADD_DEFINITIONS( -D_FREYA_DEBUG_MEMORY -D_STLP_THREADS )
ELSE(APPLE)
	ADD_DEFINITIONS( -D_FREYA_DEBUG_MEMORY )
ENDIF(APPLE)

DEFINE_PROPERTY(GLOBAL PROPERTY SHARED_PLUGINS_GLOBAL BRIEF_DOCS "Put generated shared plugin list here"  FULL_DOCS "Put generated shared plugin list here")
DEFINE_PROPERTY(GLOBAL PROPERTY FILESYSTEM_PLUGINS_GLOBAL BRIEF_DOCS "Put generated filesystem plugin list here"  FULL_DOCS "Put generated shared plugin list here")
DEFINE_PROPERTY(GLOBAL PROPERTY RENDERER_PLUGINS_GLOBAL BRIEF_DOCS "Put generated renderer plugin list here"  FULL_DOCS "Put generated shared plugin list here")
DEFINE_PROPERTY(GLOBAL PROPERTY RESOURCE_PLUGINS_GLOBAL BRIEF_DOCS "Put generated resource plugin list here"  FULL_DOCS "Put generated shared plugin list here")
DEFINE_PROPERTY(GLOBAL PROPERTY WINDOWMANAGER_PLUGINS_GLOBAL BRIEF_DOCS "Put generated windowmanager plugin list here"  FULL_DOCS "Put generated shared plugin list here")
DEFINE_PROPERTY(GLOBAL PROPERTY INPUT_PLUGINS_GLOBAL BRIEF_DOCS "Put generated input plugin list here"  FULL_DOCS "Put generated shared plugin list here")

MESSAGE("CXX flags: ${CMAKE_CXX_FLAGS}")
#Build Plugins first

#Disable boost autolink
#ADD_DEFINITIONS( -DBOOST_ALL_NO_LIB )

IF(NOT DEFINED FREYA_CORE_USE_BOOST)
	SET ( FREYA_CORE_USE_BOOST YES )
ENDIF(NOT DEFINED FREYA_CORE_USE_BOOST)

IF( FREYA_CORE_USE_BOOST )
	SET (Boost_USE_STATIC_LIBS NO)
	FIND_PACKAGE ( BoostSTLPort 1.40 ) 
	INCLUDE_DIRECTORIES ( ${Boost_INCLUDE_DIRS} )
ENDIF()

#Build math library
INCLUDE( ${CMAKE_SOURCE_DIR}/Framework/Source/math/CMakeList.txt )

#Build plugins
INCLUDE(  BuildPlugins )

#Build FreyaCore
INCLUDE ( GenerateStaticPlugins )
GenerateStaticPluginsBuild ()
IF( NOT DEFINED FREYA_CORE_SHARED )
	SET ( FREYA_CORE_SHARED YES )
ENDIF( NOT DEFINED FREYA_CORE_SHARED )


IF  ( FREYA_CORE_USE_BOOST )
	ADD_DEFINITIONS( -DUSE_BOOST_THREADS -DUSE_BOOST_FILESYSTEM )
ENDIF( FREYA_CORE_USE_BOOST )
GET_PROPERTY ( FREYA_CORE_LINK_LIBRARIES GLOBAL PROPERTY FREYA_CORE_LINK_LIBRARIES_GLOBAL )
MESSAGE ("FreyaCore additional dependencies: ${FREYA_CORE_LINK_LIBRARIES}")
ADD_SUBDIRECTORY ( Framework )

#Collect all shared plugins
GET_PROPERTY ( SHARED_PLUGINS GLOBAL PROPERTY SHARED_PLUGINS_GLOBAL )
MESSAGE( "Plugins found: ${SHARED_PLUGINS}" )
#Build Freya test executables
GET_PROPERTY ( RUNTIME_LINK_LIBRARIES GLOBAL PROPERTY RUNTIME_LINK_LIBRARIES_GLOBAL )
MESSAGE ("Executables will be linked with: ${RUNTIME_LINK_LIBRARIES}")
SET ( RUNTIME_LINK_LIBRARIES ${RUNTIME_LINK_LIBRARIES} FreyaMath_core )
# Build tests

ADD_SUBDIRECTORY ( Tests )
